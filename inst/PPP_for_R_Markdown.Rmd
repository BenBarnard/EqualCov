---
title: "A Comparison of Four Test Statistics for High-Dimensional Mean Vectors"
subtitle: "A Monte Carlo Power Simulation Study"
author: "Whitney Burrow"
date: "August 16, 2016"
output:
  ioslides_presentation:
    incremental: true
    transition: slower
    widescreen: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, eval = FALSE)
```

## Overview of Topics

- Introduction of the problem

- Test Statistics

- SVD reduction

- Simulation study

- Summary

- Future work

- References

# Introduction

## Introduction

- Considering high-dimensional data

- Interested in comparing equality of 2 and k (3) covariance matrices

- ???? test statistics for testing equality of covariance matrices

- ???? dimension reduction methods via singular value decomposition

# Statistics for Testing Equality of Covariance Matrices

## Frobenius Norm

Most of the tests given are based off of the Frobenius Norm.

 
$$ d^2 = \frac{tr(\Sigma_i - \Sigma_j)^2}{p} $$

We could just substitute with the sample covariances and and divide by the estimated variance.

$$ d^2 = \frac{tr(\Sigma_i^2)}{p} + \frac{tr(\Sigma_j^2)}{p} - \frac{2tr(\Sigma_i \Sigma_j)}{p} $$

## Consistent Estimators

$$\hat{a}_{2i} = \frac{tr(V_i^2) - \frac{1}{n_i}tr(V_i)^2}{(n_i - 1)(n_i + 2)p}$$
$$\hat{a}_2 = \frac{tr(V^2) - \frac{1}{n}tr(V)^2}{(n - 1)(n + 2)p}$$

## Schott 2007

$$ T_{Sc} = \sum \limits^{k}_{i < j} \frac{(\hat{a}_{2i} + \hat{a}_{2j} - \frac{2}{p}tr(S_i S_j)) ^ 2}{\theta}$$
$$\theta = 4 \hat{a}_2^2 \left( \sum \limits_{i < j}^ k (\frac{1}{n_i} + \frac{1}{n_j}) + (k - 1)(k - 2) \sum \limits_{i = 1}^k n_i^{-2} \right)$$



## Srivastava 2007

$$T_S = \sum \limits^k_{i=1} \frac{(\hat{a}_{2i} - \bar{\hat{a}}_2)^2}{\hat{\eta}_i^2}$$
$$\bar{\hat{a}}_2 = \frac{\sum \limits^k_{i = 1} \frac{\hat{a}_{2i}}{\hat{\eta}_i^2}}{\sum \limits^k_{i = 1} \hat{\eta}_i^{-2}}$$
$$\hat{\eta}_i^2 = \frac{4}{n^2_i}\hat{a}^2_2 \left( 1 + \frac{2 n_i \hat{a}_4}{p \hat{a}^2_2} \right)$$
$$\hat{a}_4 = \frac{p^{-1}tr(V^4) - p(4n^3+ 12n^2 + 18n)\hat{a}_1  - p^2(6n^2 4n)\hat{a}^2_1\hat{a}_2 - p(2n^3 + 5n^2 + 7n)\hat{a}^2_2 - p^3 n \hat{a}^4_1}{n^4 + 6n^3 + 21n^2 + 18n}$$

$$\hat{a}_1 = \frac{tr(S)}{p}$$

    
## Srivastava and Yanagihara 2010

$$T_{SY} = \sum \limits^k_{i = 1} \frac{(\hat{\gamma}_i - \bar{\hat{\gamma}})^2}{\hat{\xi}^2_i}$$
$$\hat{\gamma}_i = \frac{\hat{a}_{2i}}{\hat{a}^2_{1i}}$$
$$\hat{\xi}^2_i = \frac{4}{n^2_i}\left( \frac{\hat{a}^2_2}{\hat{a}^4_1} + \frac{2 n_i}{p} \left( \frac{\hat{a}^3_2}{\hat{a}^4_1} - \frac{2\hat{a}_2\hat{a}_3}{\hat{a}_1^5} + \frac{\hat{a}_4}{\hat{a}_1^4}\right)\right)$$
$$\hat{a}_3 = \frac{p^{-1}tr(V^3) - p(3n^2 + 3n)\hat{a}_2\hat{a}_1 - p^2n\hat{a}^3_1}{n^3 +3n^2 + 4n}$$
$$\bar{\hat{\gamma}} = \frac{\sum \limits^k_{i = 1} \frac{\hat{\gamma}_{2i}}{\hat{\xi}_i^2}}{\sum \limits^k_{i = 1} \hat{\xi}_i^{-2}}$$

## Chaipitak and Chongcharoen 2013

## Srivastava et al. 2014

## Ishii et al. 2016

  
# Dimension Reduction via the Singular Value Decomposition

## Dimension Reduction using the Singular Value Decomposition 
- For samples $\boldsymbol{X}_1$ and $\boldsymbol{X}_2$, let 
  $\boldsymbol{X} = \left[ \boldsymbol{X}_1 \vdots \, \boldsymbol{X}_2 \right]^T$.

- Let $\boldsymbol{S}_t$ represent the scatter matrix of $\boldsymbol{X}$, with rank $t$.

- Let $\boldsymbol{S}_t = \boldsymbol{UDU}^T$ represent the singular value decompostion of $\boldsymbol{S}_t$.

    - $\boldsymbol{U}$ is orthogonal.

    - $\boldsymbol{D} = \begin{bmatrix} \boldsymbol{D}_t & \boldsymbol{O} \\ \boldsymbol{O} & \boldsymbol{O} \end{bmatrix}$.
  
<div class="notes">
Scatter matrix: $X^t C X$ where $C = I - (1/n) 1_{n \times n}$
</div>

## Dimension Reduction Continued

- Partition $\boldsymbol{U}$ such that $\boldsymbol{U} = \left[ \boldsymbol{U}_1 \vdots \, \boldsymbol{U}_2 
  \right]$ with $\boldsymbol{U}_1 \in \mathbb{R}^{p \times t}$.

- Project $\boldsymbol{X}_1$ and $\boldsymbol{X}_2$ to $t$ dimensions by taking $\boldsymbol{X}_{Ri}^T = \boldsymbol{U}_1^T 
  \boldsymbol{X}_i^T$.

# Quantile Estimators

## Naive Quanitle Estimator for Critical Value

- Simulate $r$ repetitions of the test statistic replications under the null hypothesis.

- Select the $(r \alpha)^{th}$ largest value as the empirical critical point, $\hat{c}_{1 - \alpha}$.
        
## Brewer's Quanitle Estimator (1986) for Critical Value

- Simulate $r$ repetitions of the test statistic replications under the null hypothesis.
      
- Estimate the $1 - \alpha$ quantile with 
  $$
  \begin{aligned}
  B_{1 - \alpha} &= \sum_{i = 1}^r \left[ r^{-1} \left[ \frac{\Gamma(r + 1)}{\Gamma(i) \Gamma(r - i + 1)} \right] 
  p^{i - 1} \left( 1 - p \right)^{r - i} \right] X_{(i)} \\
  &\approx \left[ \frac{2 \pi p (1 - p)}{n + 1} \right]^{-1/2} \exp \left\lbrace {- \left( \frac{i}{n + 1} - p    
  \right)^2} \middle/ {\frac{2pq}{n + 1}} \right\rbrace
  \end{aligned}
  $$

    
## Reduced Variability in Brewer Estimator

```{r variability, message = FALSE, fig.width=10, fig.height=5.75}
library(readr)
library(ggplot2)
library(magrittr)
library(dplyr)
library(raster)

setwd("/Users/whitney_burrow/Box Sync/Research/PPP")
varSimResults <- read_csv("variability_simulation.csv")
varSimResults$estimator <- factor(varSimResults$estimator, levels = c("brewer", "crit"))

# varSimResults[["reps"]] <- factor(varSimResults$reps, levels = seq(100, 1000, by = 100))

# Consider variability measure.
varSimSummaries <- varSimResults %>%
  group_by(test, reps, estimator) %>%
  summarise(sd = sd(qEst), cv = cv(qEst), avg = mean(qEst)) %>%
  filter(test != "lee")

# ggplot(varSimSummaries, aes(x = reps, y = sd)) +
#   geom_line(aes(colour = test))

varSimSummaries <- varSimSummaries %>%
  group_by(test, reps) %>%
  summarise(sdRatio = sd[estimator == "brewer"] / sd[estimator == "crit"], 
            cvRatio = cv[estimator == "brewer"] / cv[estimator == "crit"],
            meanRatio = avg[estimator == "brewer"] / avg[estimator == "crit"])

varSimSummaries %<>% ungroup()

varSimSummaries$reps <- varSimSummaries$reps %>%
  as.character() %>% 
  as.numeric()

varSimSummaries$test <- factor(varSimSummaries$test)

levels(varSimSummaries$test) <- c("Srivastava", "Srivastava-Du", "Thulin")

cbbPalette <- c("#000000", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")

ggplot(varSimSummaries, (aes(x = reps, y = sdRatio))) + 
  geom_line(aes(colour = test), size = I(1.5)) +
  geom_point(aes(colour = test), size = I(1.5)) +
  geom_hline(yintercept = 1, colour = "black") +
  ylab("Ratio of Standard Deviations") +
  xlab("Number of Repetitions") +
  scale_colour_manual(values = cbbPalette, guide = guide_legend(title = "Test")) + 
  theme(axis.text.x = element_text(size = 12),
        axis.title.x = element_text(size = 16),
        axis.text.y = element_text(size = 12),
        axis.title.y = element_text(size = 16),
        legend.text = element_text(size = 15),
        legend.title = element_text(size = 16))

```

# Simulation Study

## Parameters for Simulation Study

The data sets generated for the simulation study have the following characteristics:

- $n_1 = n_2 = 15$

- $p = 100$

- Generating data sets from $\mathcal{N}_p \left( \boldsymbol{\mu}_i, \boldsymbol{\Sigma} \right)$

- Number of repetitions is 1000

## Description of $\boldsymbol{\Sigma}$

- Selected $\boldsymbol{\Sigma}_{0.5, 0.25}$

    - $\boldsymbol{\Sigma}_{a, b}$ represents a covariance matrix with unit variances and blocks of size 25, where 
      $\text{Cov}\left(X_{i}, X_{j} \right) = a$ if $X_i$ and $X_j$ belong to the same block and $b$ otherwise.
      
- For example, if the size of each block was 2 and $p = 6$, then
  \[
  \boldsymbol{\Sigma}_{a, b} = \begin{bmatrix}
  1 & a & b & b & b & b \\
  a & 1 & b & b & b & b \\
  b & b & 1 & a & b & b \\
  b & b & a & 1 & b & b \\
  b & b & b & b & 1 & a \\
  b & b & b & b & a & 1
  \end{bmatrix}.
  \]
  
## Description of $\boldsymbol{\mu}_i$

- $\boldsymbol{\mu}_1 = \boldsymbol{1}_{100}$

- $\boldsymbol{\mu}_2$ shifted the means evenly by some value $\delta$ for the first $m$ values per block of 
  $\boldsymbol{\mu}_1$ with $m = (1, 5, 10)$.
  
    - In other words, 
    \[
    \boldsymbol{\mu}_{2i} = \left[ \left( \boldsymbol{1 + \delta} \right)_m \vdots \boldsymbol{1}_{25 - m} \right]
    \]
    for $i = 1, 2, 3, 4$.
    
    - Then
    \[
    \boldsymbol{\mu}_2 = \left[ \boldsymbol{\mu}_{21} \vdots \, \boldsymbol{\mu}_{22} \vdots \, \boldsymbol{\mu}_{23} \vdots
    \, \boldsymbol{\mu}_{24} \right].
    \]

## Simulation Results for m = 1

```{r param1, message = FALSE, fig.width=9.75, fig.height=5.75}
library(readr)
library(ggplot2)
library(magrittr)
library(dplyr)
library(tidyr)
library(gridExtra)

setwd("/Users/whitney_burrow/Box Sync/Research/PPP/Power Results")

powerResults1 <- read_csv("power_results_1_new.csv")

powerResults1 %<>%
  mutate(dist = sqrt(dist))

powerResults1Difference <- powerResults1 %>%
  group_by(test, dist) %>%
  summarise(difference = power[datatype == "svd"] - power[datatype == "full"])

powerResults1Difference$test <- factor(powerResults1Difference$test)

levels(powerResults1Difference$test) <- c("Bai-Sarandasa", "Srivastava", "Srivastava-Du", "Thulin")

### Plot power Results

full <- ggplot(data = powerResults1 %>% filter(datatype == "full"), aes(x = dist, y = power)) +
  geom_line(aes(colour = test), size = I(1.2)) +
  xlab("") +
  ylab("Full Power") +
  scale_colour_manual(values = cbbPalette, name = "Test") +
  scale_linetype_discrete(name = "Data Type") +
  scale_alpha_discrete(name = "Data Type", range = c(0.5, 1)) +
  theme(text = element_text(size=20), axis.text.y = element_text(size = 9),
        axis.title.y = element_text(size = 12),
        legend.position = "none") 

svd <- ggplot(data = powerResults1 %>% filter(datatype == "svd"), aes(x = dist, y = power)) +
  geom_line(aes(colour = test), size = I(1.2)) +
  xlab("") +
  ylab("SVD Power") +
  scale_colour_manual(values = cbbPalette, name = "Test") +
  scale_linetype_discrete(name = "Data Type") +
  scale_alpha_discrete(name = "Data Type", range = c(0.5, 1)) +
  theme(text = element_text(size=20), axis.text.y = element_text(size = 9),
        axis.title.y = element_text(size = 12),
        legend.position = "none")

diff <- ggplot(data = powerResults1Difference, aes(x = dist, y = difference)) +
  geom_line(aes(colour = test), size = I(1.2)) +
  xlab("Mahalanobis Distance") +
  ylab("Difference") +
  scale_colour_manual(values = cbbPalette, name = "Test") +
  scale_linetype_discrete(name = "Data Type") +
  scale_alpha_discrete(name = "Data Type", range = c(0.5, 1)) +
  theme(text = element_text(size=20), axis.text.y = element_text(size = 9),
        axis.title.y = element_text(size = 12),
        legend.position = "bottom", legend.direction="horizontal") 

grid.arrange(full, svd, diff, ncol = 1, heights = c(0.3, 0.3, 0.4))
```

<div class="notes">
$\sqrt{(\bar{x}_1 - \bar{x}_2)^T S^{-1} (\bar{x}_1 - \bar{x}_2)}$
</div>

## Simulation Results for m = 5

```{r param2, message = FALSE, fig.width=10, fig.height=5.75}
setwd("/Users/whitney_burrow/Box Sync/Research/PPP/Power Results")

powerResults2 <- read_csv("power_results_2_new.csv")

powerResults2 %<>%
  mutate(dist = sqrt(dist))

powerResults2Difference <- powerResults2 %>%
  group_by(test, dist) %>%
  summarise(difference = power[datatype == "svd"] - power[datatype == "full"])

powerResults2Difference$test <- factor(powerResults2Difference$test)

levels(powerResults2Difference$test) <- c("Bai-Sarandasa", "Srivastava", "Srivastava-Du", "Thulin")

### Plot power Results

full <- ggplot(data = powerResults2 %>% filter(datatype == "full"), aes(x = dist, y = power)) +
  geom_line(aes(colour = test), size = I(1.2)) +
  xlab("") +
  ylab("Full Power") +
  scale_colour_manual(values = cbbPalette, name = "Test") +
  scale_linetype_discrete(name = "Data Type") +
  scale_alpha_discrete(name = "Data Type", range = c(0.5, 1)) +
  theme(text = element_text(size=20), axis.text.y = element_text(size = 9),
        axis.title.y = element_text(size = 12),
        legend.position = "none")

svd <- ggplot(data = powerResults2 %>% filter(datatype == "svd"), aes(x = dist, y = power)) +
  geom_line(aes(colour = test), size = I(1.2)) +
  xlab("") +
  ylab("SVD Power") +
  scale_colour_manual(values = cbbPalette, name = "Test") +
  scale_linetype_discrete(name = "Data Type") +
  scale_alpha_discrete(name = "Data Type", range = c(0.5, 1)) +
  theme(text = element_text(size=20), axis.text.y = element_text(size = 9),
        axis.title.y = element_text(size = 12),
        legend.position = "none")

diff <- ggplot(data = powerResults2Difference, aes(x = dist, y = difference)) +
  geom_line(aes(colour = test), size = I(1.2)) +
  xlab("Mahalanobis Distance") +
  ylab("Difference") +
  scale_colour_manual(values = cbbPalette, name = "Test") +
  scale_linetype_discrete(name = "Data Type") +
  scale_alpha_discrete(name = "Data Type", range = c(0.5, 1)) +
  theme(text = element_text(size=20), axis.text.y = element_text(size = 9),
        axis.title.y = element_text(size = 12),
        legend.position = "bottom", legend.direction="horizontal") 

grid.arrange(full, svd, diff, ncol = 1, heights = c(0.3, 0.3, 0.4))
```


## Simulation Results for m = 10

```{r param3, message = FALSE, fig.width=10, fig.height=5.75}
setwd("/Users/whitney_burrow/Box Sync/Research/PPP/Power Results")

powerResults3 <- read_csv("power_results_3_new.csv")

powerResults3 %<>%
  mutate(dist = sqrt(dist))

powerResults3Difference <- powerResults3 %>%
  group_by(test, dist) %>%
  summarise(difference = power[datatype == "svd"] - power[datatype == "full"])

powerResults3Difference$test <- factor(powerResults3Difference$test)

levels(powerResults3Difference$test) <- c("Bai-Sarandasa", "Srivastava", "Srivastava-Du", "Thulin")

### Plot power Results

full <- ggplot(data = powerResults3 %>% filter(datatype == "full"), aes(x = dist, y = power)) +
  geom_line(aes(colour = test), size = I(1.2)) +
  xlab("") +
  ylab("Full Power") +
  scale_colour_manual(values = cbbPalette, name = "Test") +
  scale_linetype_discrete(name = "Data Type") +
  scale_alpha_discrete(name = "Data Type", range = c(0.5, 1)) +
  theme(text = element_text(size=20), axis.text.y = element_text(size = 9),
        axis.title.y = element_text(size = 12),
        legend.position = "none") 

svd <- ggplot(data = powerResults3 %>% filter(datatype == "svd"), aes(x = dist, y = power)) +
  geom_line(aes(colour = test), size = I(1.2)) +
  xlab("") +
  ylab("SVD Power") +
  scale_colour_manual(values = cbbPalette, name = "Test") +
  scale_linetype_discrete(name = "Data Type") +
  scale_alpha_discrete(name = "Data Type", range = c(0.5, 1)) +
  theme(text = element_text(size=20), axis.text.y = element_text(size = 9),
        axis.title.y = element_text(size = 12),
        legend.position = "none")

diff <- ggplot(data = powerResults3Difference, aes(x = dist, y = difference)) +
  geom_line(aes(colour = test), size = I(1.2)) +
  xlab("Mahalanobis Distance") +
  ylab("Difference") +
  scale_colour_manual(values = cbbPalette, name = "Test") +
  scale_linetype_discrete(name = "Data Type") +
  scale_alpha_discrete(name = "Data Type", range = c(0.5, 1)) +
  theme(text = element_text(size=20), axis.text.y = element_text(size = 9),
        axis.title.y = element_text(size = 12),
        legend.position = "bottom", legend.direction="horizontal") 

grid.arrange(full, svd, diff, ncol = 1, heights = c(0.3, 0.3, 0.4))
```

# Summary and References

## Summary

- Looked at two samples of high-dimensional data with equal covariance matrices

- Considered four test statistics for testing differences in high-dimensional mean vectors

- Used singular valued decomposition to reduce dimension of data sets

- Considered two methods of quantile estimation

- Compared methods via power simulation

## Future Work

- Dimension reduction method presented by Fan et al. (2012)

- Additional dimension reduction using M-method to drop to low-dimensional scenario

- Goal: perform low-dimensional tests on reduced data and seeing similar or better power
  than high dimensional tests

## References {.smaller}

---
nocite: |
  @srivastava_multivariate_2007, @srivastava_test_2008, @ye_regularized_2006, 
  @bai_effect_1996, @thulin_high-dimensional_2014
...

